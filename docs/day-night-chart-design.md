# 昼夜表 (DayNightChart) — 设计文稿

> 系统根基组件，所有优化都应围绕昼夜表展开
> 持续更新中

---

## 当前实现

- 24列 × 12行 Canvas 渲染，每格 5 分钟
- 活动迹线：彩色竖线段 + 焊点节点 + 悬浮光晕
- 收起/展开：默认当前±8小时，展开全天 24 列
- 数据源：ActivityCardRecord → ChronosActivityConverter → ChronosActivity
- 右栏：点击格子显示 ChronosCellDetailView

## 核心问题

### 1. AI 输出语无伦次、碎片化

**根因：AI 看屏幕 ≠ 人看屏幕**

人的注意力是选择性的 — 屏幕上 50 个按钮，人只盯着编辑器那一行代码。
但 AI 会把所有东西都描述一遍，导致：

- **碎片化**：明明一直在写代码，被拆成"编辑文件A"、"查看终端"、"浏览 GitHub" 三张卡片
- **误判主线**：看到浏览器标签就以为切换了任务
- **冗余描述**：detailedSummary 塞满无关细节，真正做的事被淹没
- **误判新任务**：AI 把背景窗口当成独立任务

**本质：AI 缺乏「注意力焦点」概念**

人看一个界面，80% 注意力在一个区域。AI 是均匀扫描。
所以 AI 很容易因为细枝末节写出一大堆东西，但并非主人真正在做的事。

很多软件界面进入眼睛的时候，人的注意力并非把所有按钮都看一遍。
AI 却什么都会说，导致很容易误判主线、误判出很多新任务，
无法得知主人其实一直只在做一件事。

### 2. Qwen 时间感知不如 Gemini

切换到 Qwen 后，活动卡片的时间感知变差了。
可能原因：
- 提示词从给真实时间戳改为视频秒数（需要验证是否是这个导致的）
- Qwen 对视频帧的理解能力本身就不如 Gemini
- 需要对比测试

### 3. 缺乏直观的视频-时间映射展现

目前昼夜表的格子是纯色块 + 文字，看不到"那个时刻屏幕上到底是什么"。
用户点一个格子，应该能直接看到那一刻的截屏/视频画面。

## 布局设计

### 收缩状态（默认）

核心视图，展示**当前时刻附近 2 小时**的截屏缩略图矩阵。

```
4 列 × 6 行 = 24 格
2 列 = 1 小时 → 每列 = 30 分钟
6 行 → 每行 = 5 分钟
覆盖范围：上一个小时 + 当前小时（共 2 小时）
```

**单元格**：
- 比例按 macOS 屏幕比例（约 16:10）
- 背景 = 该时间点的截屏缩略图
- 上方叠加活动迹线、焊点等信息层

视觉效果：一眼就能看到最近 2 小时每 5 分钟的屏幕画面流。
左侧栏（状态/任务/设置）正常显示。

### 展开状态

展示全天 24 小时（48 列 × 6 行）。

- **当前时间节点始终保持在视野中间**（而非左边缘）
- 滚动到任意时段查看历史截屏
- 左侧栏收起，腾出空间

### 切换逻辑

- 收缩 → 展开：侧栏把手点击，展开后自动滚动到当前时间居中
- 展开 → 收缩：侧栏把手点击，回到只显示近 2 小时

---

## 设计方向

### 方向 A：截屏缩略图作为单元格背景 ✅ 确认

每个 5 分钟格子的背景 = 该时间点的截屏缩略图。
一眼就能看到一整天的屏幕变化流。

- 从 screenshots 目录加载对应时间段的截图，缩放到格子大小
- 迹线和焊点画在缩略图上方
- 收缩状态下是主要信息载体

### 方向 B：集成视频播放器

点击昼夜表的某个区域，右栏弹出视频播放器，播放那段时间的延时摄影。
播放进度与昼夜表联动 — 播放到哪一秒，昼夜表上对应的格子高亮。

### 方向 C：AI 提示词根治

重新设计 Phase 1 (视频转录) 提示词：
- 不要"仔细观察每一帧"，而是"判断用户的注意力焦点"
- 倾向合并而非拆分 — 同一个项目/同一件事不要拆成多张卡片
- 区分"前台活动"和"背景窗口"
- 对"主人一直在做一件事"的情况，要能识别出来

### 方向 D：实时活动流（不等 AI）

AI 分析有延迟（要等活跃期结束 + API 调用）。
昼夜表应该有实时层：基于规则引擎的即时分类（RuleClassifier 已有），
在 AI 结果回来之前就显示"正在做什么"。

## 待讨论

- [ ] 展开状态的列数：48列（每列30分钟）还是保持24列（每列1小时）？
- [ ] 缩略图加载性能优化方案
- [ ] Qwen vs Gemini 对比测试
- [ ] AI "一件事"合并策略
- [ ] 方向 B/C/D 优先级
