<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Áã¨Ëá™ÂçáÁ∫ßÁ≥ªÁªü</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap');
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg:#050510;--panel-bg:rgba(8,14,40,0.85);--panel-border:rgba(60,140,255,0.4);--blue:#3c8cff;--blue-light:#7ab8ff;--blue-dim:#1a3a6a;--gold:#ffd700;--red:#ff4455;--green:#44ff88;--cyan:#60ddff;--text:#c8d8f0;--text-dim:rgba(160,180,220,0.5)}
        body{font-family:'Noto Sans SC',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
        body::after{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(60,140,255,0.015) 2px,rgba(60,140,255,0.015) 4px);pointer-events:none;z-index:9999}
        body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 25% 20%,rgba(60,140,255,0.06) 0%,transparent 50%),radial-gradient(ellipse at 75% 80%,rgba(60,140,255,0.04) 0%,transparent 50%);pointer-events:none;z-index:0}
        .container{max-width:1320px;margin:0 auto;padding:16px;position:relative;z-index:1}
        .sys-header{text-align:center;padding:28px 0 22px;margin-bottom:20px}
        .sys-header h1{font-family:'Orbitron','Noto Sans SC',sans-serif;font-size:2.4em;font-weight:900;color:var(--blue-light);text-shadow:0 0 30px rgba(60,140,255,0.5),0 0 60px rgba(60,140,255,0.2);letter-spacing:8px;text-transform:uppercase}
        .sys-header .sys-sub{font-family:'Orbitron',monospace;color:var(--text-dim);font-size:0.75em;letter-spacing:4px;margin-top:6px}
        .conn-status{margin-top:12px;display:inline-flex;align-items:center;gap:8px;font-size:0.8em;font-family:'Orbitron',monospace;letter-spacing:2px}
        .conn-dot{width:8px;height:8px;border-radius:50%;display:inline-block}
        .conn-dot.online{background:var(--green);box-shadow:0 0 8px var(--green),0 0 16px rgba(68,255,136,0.3);animation:pulse-dot 2s ease-in-out infinite}
        .conn-dot.offline{background:var(--red);box-shadow:0 0 8px var(--red);animation:pulse-dot 1s ease-in-out infinite}
        @keyframes pulse-dot{0%,100%{opacity:1}50%{opacity:0.4}}
        .conn-text.online{color:var(--green)}.conn-text.offline{color:var(--red)}
        .panel{position:relative;background:var(--panel-bg);border:1px solid var(--panel-border);padding:22px;margin-bottom:16px;animation:panel-in 0.5s ease-out both;backdrop-filter:blur(4px)}
        @keyframes panel-in{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        .panel::before,.panel::after{content:'';position:absolute;width:14px;height:14px;pointer-events:none}
        .panel::before{top:-1px;left:-1px;border-top:2px solid var(--blue);border-left:2px solid var(--blue)}
        .panel::after{top:-1px;right:-1px;border-top:2px solid var(--blue);border-right:2px solid var(--blue)}
        .panel .corner-bl,.panel .corner-br{position:absolute;width:14px;height:14px;pointer-events:none}
        .panel .corner-bl{bottom:-1px;left:-1px;border-bottom:2px solid var(--blue);border-left:2px solid var(--blue)}
        .panel .corner-br{bottom:-1px;right:-1px;border-bottom:2px solid var(--blue);border-right:2px solid var(--blue)}
        .panel-title{font-family:'Orbitron','Noto Sans SC',sans-serif;font-size:0.85em;font-weight:700;color:var(--blue-light);letter-spacing:3px;margin-bottom:16px;padding-bottom:10px;border-bottom:1px solid rgba(60,140,255,0.15);display:flex;align-items:center;gap:8px;text-transform:uppercase}
        .panel-title .tb{color:var(--blue);opacity:0.6}
        .panel-title .extra{margin-left:auto;font-size:0.85em;color:var(--gold);letter-spacing:1px}
        .grid-main{display:grid;grid-template-columns:1fr 1fr;gap:16px}
        .grid-tri{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
        .grid-duo{display:grid;grid-template-columns:1fr 1fr;gap:16px}
        @media(max-width:900px){.grid-main,.grid-tri,.grid-duo{grid-template-columns:1fr}}
        .player-header{display:flex;align-items:center;gap:18px}
        .player-avatar{width:80px;height:80px;border:2px solid var(--blue);background:rgba(60,140,255,0.08);display:flex;align-items:center;justify-content:center;font-size:2.2em;flex-shrink:0;position:relative;box-shadow:0 0 20px rgba(60,140,255,0.15),inset 0 0 20px rgba(60,140,255,0.05)}
        .player-avatar::before{content:'';position:absolute;top:-4px;left:-4px;width:16px;height:16px;border-top:1px solid var(--blue);border-left:1px solid var(--blue)}
        .player-avatar::after{content:'';position:absolute;bottom:-4px;right:-4px;width:16px;height:16px;border-bottom:1px solid var(--blue);border-right:1px solid var(--blue)}
        .player-name{font-family:'Orbitron','Noto Sans SC',sans-serif;font-size:1.5em;font-weight:700;color:#fff;text-shadow:0 0 10px rgba(60,140,255,0.3)}
        .player-title-text{color:var(--gold);font-size:0.85em;margin-top:2px;text-shadow:0 0 10px rgba(255,215,0,0.2)}
        .player-level{font-family:'Orbitron',monospace;color:var(--blue-light);font-size:0.8em;margin-top:4px;letter-spacing:2px}
        .exp-section{margin-top:18px}
        .exp-labels{display:flex;justify-content:space-between;font-family:'Orbitron',monospace;font-size:0.72em;color:var(--text-dim);margin-bottom:6px;letter-spacing:1px}
        .exp-pct{color:var(--blue-light)}
        .exp-track{height:12px;background:rgba(60,140,255,0.08);border:1px solid rgba(60,140,255,0.2);position:relative;overflow:hidden}
        .exp-fill{height:100%;background:linear-gradient(90deg,var(--blue-dim),var(--blue));box-shadow:0 0 12px rgba(60,140,255,0.5),0 0 24px rgba(60,140,255,0.2);transition:width 0.6s ease;position:relative}
        .exp-fill::after{content:'';position:absolute;right:0;top:0;bottom:0;width:4px;background:var(--blue-light);box-shadow:0 0 8px var(--blue-light),0 0 16px var(--blue)}
        .stats-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-top:18px}
        .stat-item{text-align:center;padding:12px 6px;border:1px solid rgba(60,140,255,0.12);background:rgba(60,140,255,0.03)}
        .stat-value{font-family:'Orbitron',monospace;font-size:1.6em;font-weight:700;color:var(--blue-light);text-shadow:0 0 8px rgba(60,140,255,0.3)}
        .stat-label{font-size:0.68em;color:var(--text-dim);margin-top:4px;letter-spacing:1px}
        .stat-bar{margin-top:6px;height:2px;background:rgba(60,140,255,0.1)}
        .stat-bar-fill{height:100%;background:var(--blue);transition:width 0.4s;box-shadow:0 0 4px var(--blue)}
        @media(max-width:600px){.stats-grid{grid-template-columns:repeat(3,1fr)}}
        .buff-section{margin-top:14px;padding-top:12px;border-top:1px solid rgba(60,140,255,0.1)}
        .buff-section-title{font-size:0.72em;color:var(--text-dim);letter-spacing:2px;margin-bottom:8px;font-family:'Orbitron',monospace}
        .buff-tag{display:inline-flex;align-items:center;gap:4px;padding:4px 12px;margin:3px;font-size:0.78em;border:1px solid}
        .buff-pos{border-color:rgba(60,140,255,0.3);color:var(--cyan);background:rgba(60,140,255,0.06)}
        .buff-neg{border-color:rgba(255,68,85,0.3);color:var(--red);background:rgba(255,68,85,0.06)}
        .quest-item{padding:12px 14px;margin-bottom:8px;background:rgba(60,140,255,0.03);border:1px solid rgba(60,140,255,0.1);display:flex;justify-content:space-between;align-items:center;transition:all 0.2s}
        .quest-item:hover{background:rgba(60,140,255,0.07);border-color:rgba(60,140,255,0.3);box-shadow:0 0 12px rgba(60,140,255,0.08)}
        .quest-left{display:flex;align-items:center;gap:10px;flex:1;min-width:0}
        .quest-title-text{font-size:0.88em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .diff-badge{padding:2px 8px;font-family:'Orbitron',monospace;font-size:0.65em;font-weight:700;letter-spacing:1px;flex-shrink:0;border:1px solid}
        .d-S{background:rgba(255,0,0,.12);color:#f44;border-color:#f44}.d-A{background:rgba(255,165,0,.12);color:#fa0;border-color:#fa0}
        .d-B{background:rgba(153,102,255,.12);color:#96f;border-color:#96f}.d-C{background:rgba(60,140,255,.12);color:var(--blue);border-color:var(--blue)}
        .d-D{background:rgba(68,255,136,.12);color:var(--green);border-color:var(--green)}.d-E{background:rgba(136,136,170,.12);color:#88a;border-color:#88a}
        .quest-right{display:flex;align-items:center;gap:10px;flex-shrink:0}
        .quest-exp{color:var(--gold);font-family:'Orbitron',monospace;font-size:0.72em;letter-spacing:1px;text-shadow:0 0 8px rgba(255,215,0,0.2)}
        .btn-sys{background:transparent;color:var(--green);border:1px solid rgba(68,255,136,0.3);padding:5px 12px;font-family:'Orbitron',monospace;font-size:0.65em;cursor:pointer;transition:all 0.2s;letter-spacing:1px}
        .btn-sys:hover{background:rgba(68,255,136,0.1);border-color:var(--green);box-shadow:0 0 10px rgba(68,255,136,0.15)}
        .btn-buy{background:transparent;color:var(--gold);border:1px solid rgba(255,215,0,0.3);padding:5px 12px;font-family:'Orbitron',monospace;font-size:0.65em;cursor:pointer;transition:all 0.2s;letter-spacing:1px}
        .btn-buy:hover{background:rgba(255,215,0,0.08);border-color:var(--gold)}.btn-buy:disabled{opacity:0.3;cursor:default}
        .log-item{padding:9px 12px;margin-bottom:6px;border-left:2px solid var(--blue);background:rgba(60,140,255,0.02)}
        .log-time{font-family:'Orbitron',monospace;font-size:0.65em;color:var(--text-dim);letter-spacing:1px}
        .log-focus{font-family:monospace;font-size:0.68em;color:var(--blue);margin-left:6px}
        .log-text{font-size:0.82em;margin-top:3px}.log-motive{font-size:0.7em;color:var(--text-dim);margin-top:2px}
        .ach-header{text-align:center;padding:8px 0 14px}
        .ach-pct{font-family:'Orbitron',monospace;font-size:2em;font-weight:900;color:var(--gold);text-shadow:0 0 16px rgba(255,215,0,0.3)}
        .ach-label{font-size:0.72em;color:var(--text-dim);letter-spacing:2px}
        .ach-item{padding:10px 12px;margin-bottom:6px;display:flex;align-items:center;gap:10px;border:1px solid rgba(60,140,255,0.08)}
        .ach-unlocked{background:rgba(255,215,0,0.04);border-color:rgba(255,215,0,0.15)}
        .ach-locked{background:rgba(60,80,120,0.04);opacity:0.45}
        .ach-icon{font-size:1.2em;flex-shrink:0}.ach-info{flex:1;min-width:0}
        .ach-name{font-size:0.85em;font-weight:600}.ach-desc{font-size:0.7em;color:var(--text-dim)}
        .ach-reward{color:var(--gold);font-family:'Orbitron',monospace;font-size:0.68em;flex-shrink:0}
        .shop-item{padding:10px 14px;margin-bottom:6px;background:rgba(60,140,255,0.03);border:1px solid rgba(60,140,255,0.1);display:flex;justify-content:space-between;align-items:center;transition:all 0.2s}
        .shop-item:hover{border-color:rgba(60,140,255,0.25)}
        .shop-name{font-size:0.85em}.shop-desc{font-size:0.7em;color:var(--text-dim);margin-top:2px}
        .shop-right{display:flex;align-items:center;gap:8px;flex-shrink:0}
        .shop-price{color:var(--gold);font-family:'Orbitron',monospace;font-size:0.72em}
        .skills-cols{display:grid;grid-template-columns:1fr 1fr;gap:14px}
        .skill-col-title{font-family:'Orbitron',monospace;font-size:0.65em;color:var(--text-dim);letter-spacing:2px;margin-bottom:8px}
        .skill-item{padding:8px 12px;margin-bottom:5px;display:flex;align-items:center;gap:8px;border:1px solid rgba(60,140,255,0.08);transition:all 0.2s}
        .skill-item.unlocked{background:rgba(60,140,255,0.04);border-color:rgba(60,140,255,0.15)}
        .skill-item.locked{opacity:0.4}.skill-item.clickable{cursor:pointer}
        .skill-item.clickable:hover{border-color:var(--blue);background:rgba(60,140,255,0.08)}
        .skill-icon{font-size:1em;flex-shrink:0}.skill-info{flex:1;min-width:0}
        .skill-name{font-size:0.8em;font-weight:500}.skill-desc-text{font-size:0.68em;color:var(--text-dim)}
        .skill-cd{color:var(--red);font-size:0.65em;font-family:'Orbitron',monospace}
        @media(max-width:600px){.skills-cols{grid-template-columns:1fr}}
        .device-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:10px}
        .device-card{padding:14px;border:1px solid rgba(60,140,255,0.1);background:rgba(60,140,255,0.02);text-align:center;position:relative;transition:all 0.25s}
        .device-card.active{border-color:rgba(68,255,136,0.3);background:rgba(68,255,136,0.03);box-shadow:0 0 12px rgba(68,255,136,0.08)}
        .device-card.offline{opacity:0.35}
        .device-active-dot{position:absolute;top:8px;right:8px;width:8px;height:8px;border-radius:50%;background:var(--green);box-shadow:0 0 6px var(--green);animation:pulse-dot 2s ease-in-out infinite}
        .device-icon{font-size:1.8em;margin-bottom:6px}.device-name{font-size:0.85em;font-weight:600}
        .device-status-text{font-size:0.7em;margin-top:4px}
        .device-detail{font-size:0.68em;color:var(--text-dim);margin-top:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .switch-section{margin-top:12px;padding-top:10px;border-top:1px solid rgba(60,140,255,0.08)}
        .switch-title{font-family:'Orbitron',monospace;font-size:0.65em;color:var(--text-dim);letter-spacing:2px;margin-bottom:6px}
        .switch-item{font-size:0.72em;padding:4px 8px;margin-bottom:3px;border-left:2px solid var(--blue-dim);color:var(--text-dim)}
        .penalty-box{text-align:center;padding:20px 10px}
        .penalty-icon{font-size:2.4em;display:block;margin-bottom:8px}
        .penalty-status{font-family:'Orbitron','Noto Sans SC',sans-serif;font-weight:700;font-size:1em;letter-spacing:2px}
        .penalty-desc{font-size:0.78em;color:var(--text-dim);margin-top:4px}
        .notif-container{position:fixed;top:16px;right:16px;z-index:10000;display:flex;flex-direction:column;gap:8px;pointer-events:none}
        .notif{padding:14px 18px;background:var(--panel-bg);border:1px solid var(--panel-border);box-shadow:0 0 24px rgba(60,140,255,0.15),0 4px 20px rgba(0,0,0,0.5);max-width:360px;pointer-events:auto;position:relative;animation:notif-in 0.3s ease,notif-out 0.5s ease 4s forwards}
        .notif::before{content:'';position:absolute;top:-1px;left:-1px;width:10px;height:10px;border-top:2px solid var(--blue);border-left:2px solid var(--blue)}
        .notif::after{content:'';position:absolute;bottom:-1px;right:-1px;width:10px;height:10px;border-bottom:2px solid var(--blue);border-right:2px solid var(--blue)}
        .notif-t{font-family:'Orbitron','Noto Sans SC',sans-serif;font-weight:700;margin-bottom:4px;font-size:0.85em;color:var(--blue-light);letter-spacing:1px}
        .notif-m{font-size:0.78em;color:var(--text-dim);white-space:pre-line}
        @keyframes notif-in{from{transform:translateX(120%);opacity:0}to{transform:translateX(0);opacity:1}}
        @keyframes notif-out{to{opacity:0;transform:translateY(-8px)}}
        .empty{text-align:center;color:var(--text-dim);padding:20px;font-size:0.82em;letter-spacing:1px}
        .scroll-area{max-height:300px;overflow-y:auto}
        .scroll-area::-webkit-scrollbar{width:4px}
        .scroll-area::-webkit-scrollbar-track{background:transparent}
        .scroll-area::-webkit-scrollbar-thumb{background:var(--blue-dim)}
    </style>
</head>
<body>
<div class="container">
    <div class="sys-header">
        <h1>‚öî SYSTEM</h1>
        <div class="sys-sub">SOLO LEVELING SYSTEM v0.1.0</div>
        <div class="conn-status" id="connStatus">
            <span class="conn-dot offline" id="connDot"></span>
            <span class="conn-text offline" id="connText">CONNECTING...</span>
        </div>
    </div>
    <div class="grid-main">
        <div class="panel" style="animation-delay:0s">
            <div class="corner-bl"></div><div class="corner-br"></div>
            <div class="panel-title"><span class="tb">[</span>STATUS<span class="tb">]</span></div>
            <div class="player-header">
                <div class="player-avatar">‚öîÔ∏è</div>
                <div>
                    <div class="player-name" id="pName">LOADING...</div>
                    <div class="player-title-text" id="pTitle">-</div>
                    <div class="player-level" id="pLevel">LV. -</div>
                </div>
            </div>
            <div class="exp-section">
                <div class="exp-labels"><span id="expL">EXP: 0 / 100</span><span class="exp-pct" id="expP">0%</span></div>
                <div class="exp-track"><div class="exp-fill" id="expF" style="width:0%"></div></div>
            </div>
            <div class="stats-grid">
                <div class="stat-item"><div class="stat-value" id="sF">-</div><div class="stat-label">‰∏ìÊ≥®Âäõ</div><div class="stat-bar"><div class="stat-bar-fill" id="sFbar" style="width:0%"></div></div></div>
                <div class="stat-item"><div class="stat-value" id="sP">-</div><div class="stat-label">Áîü‰∫ßÂäõ</div><div class="stat-bar"><div class="stat-bar-fill" id="sPbar" style="width:0%"></div></div></div>
                <div class="stat-item"><div class="stat-value" id="sC">-</div><div class="stat-label">ÊåÅÁª≠ÊÄß</div><div class="stat-bar"><div class="stat-bar-fill" id="sCbar" style="width:0%"></div></div></div>
                <div class="stat-item"><div class="stat-value" id="sR">-</div><div class="stat-label">ÂàõÈÄ†Âäõ</div><div class="stat-bar"><div class="stat-bar-fill" id="sRbar" style="width:0%"></div></div></div>
                <div class="stat-item"><div class="stat-value" id="sW">-</div><div class="stat-label">ÂÅ•Â∫∑Â∫¶</div><div class="stat-bar"><div class="stat-bar-fill" id="sWbar" style="width:0%"></div></div></div>
            </div>
            <div class="buff-section">
                <div class="buff-section-title">ACTIVE EFFECTS</div>
                <div id="buffList"><div class="empty">NO ACTIVE EFFECTS</div></div>
            </div>
        </div>
        <div style="display:flex;flex-direction:column;gap:16px">
            <div class="panel" style="animation-delay:0.1s;flex:1">
                <div class="corner-bl"></div><div class="corner-br"></div>
                <div class="panel-title"><span class="tb">[</span>DAILY QUESTS<span class="tb">]</span></div>
                <div id="questList" class="scroll-area"><div class="empty">NO ACTIVE QUESTS</div></div>
            </div>
            <div class="panel" style="animation-delay:0.15s;flex:1">
                <div class="corner-bl"></div><div class="corner-br"></div>
                <div class="panel-title"><span class="tb">[</span>ACTIVITY LOG<span class="tb">]</span></div>
                <div id="timeline" class="scroll-area"><div class="empty">NO ACTIVITY RECORDED</div></div>
            </div>
        </div>
    </div>
    <div class="grid-tri">
        <div class="panel" style="animation-delay:0.2s">
            <div class="corner-bl"></div><div class="corner-br"></div>
            <div class="panel-title"><span class="tb">[</span>ACHIEVEMENTS<span class="tb">]</span></div>
            <div class="ach-header">
                <div class="ach-pct" id="achPct">0%</div>
                <div class="ach-label" id="achLabel">0 / 0 UNLOCKED</div>
            </div>
            <div id="achList" class="scroll-area"><div class="empty">LOADING...</div></div>
        </div>
        <div class="panel" style="animation-delay:0.25s">
            <div class="corner-bl"></div><div class="corner-br"></div>
            <div class="panel-title"><span class="tb">[</span>SHOP<span class="tb">]</span><span class="extra" id="goldDisplay">üí∞ 0G</span></div>
            <div id="shopList" class="scroll-area"><div class="empty">LOADING...</div></div>
        </div>
        <div class="panel" style="animation-delay:0.3s">
            <div class="corner-bl"></div><div class="corner-br"></div>
            <div class="panel-title"><span class="tb">[</span>SKILLS<span class="tb">]</span></div>
            <div class="skills-cols">
                <div>
                    <div class="skill-col-title">PASSIVE</div>
                    <div id="passiveSkills"><div class="empty">LOADING...</div></div>
                </div>
                <div>
                    <div class="skill-col-title">ACTIVE</div>
                    <div id="activeSkills"><div class="empty">LOADING...</div></div>
                </div>
            </div>
        </div>
    </div>
    <div class="grid-duo">
        <div class="panel" style="animation-delay:0.35s">
            <div class="corner-bl"></div><div class="corner-br"></div>
            <div class="panel-title"><span class="tb">[</span>DEVICES<span class="tb">]</span><span class="extra" id="deviceBadge" style="color:var(--text-dim)">DETECTING...</span></div>
            <div id="devicePanel"><div class="empty">DETECTING OPENCLAW NODES...</div></div>
            <div id="deviceSwitches" style="display:none">
                <div class="switch-section">
                    <div class="switch-title">DEVICE SWITCH LOG</div>
                    <div id="switchList"></div>
                </div>
            </div>
        </div>
        <div class="panel" style="animation-delay:0.4s">
            <div class="corner-bl"></div><div class="corner-br"></div>
            <div class="panel-title"><span class="tb">[</span>PENALTY<span class="tb">]</span></div>
            <div class="penalty-box" id="penaltyStatus">
                <span class="penalty-icon">‚úÖ</span>
                <div class="penalty-status" style="color:var(--green)">SAFE</div>
                <div class="penalty-desc">ÊØèÊó•‰ªªÂä°Áä∂ÊÄÅÊ≠£Â∏∏</div>
            </div>
        </div>
    </div></div>
<div class="notif-container" id="notifs"></div>

<script>
const _pathBase = location.pathname.replace(/\/[^/]*$/, '').replace(/\/$/, '');
const B = _pathBase;
let ws;

function el(id) { return document.getElementById(id); }

async function init() {
    await Promise.all([fetchStatus(), fetchQuests(), fetchSnapshots(), fetchAchievements(), fetchPattern(), fetchShop(), fetchSkills(), fetchPenalty(), fetchDevices()]);
    connectWS();
    setInterval(fetchStatus, 8000);
    setInterval(fetchQuests, 12000);
    setInterval(fetchSnapshots, 20000);
    setInterval(fetchAchievements, 15000);
    setInterval(fetchPattern, 10000);
    setInterval(fetchShop, 15000);
    setInterval(fetchSkills, 20000);
    setInterval(fetchPenalty, 30000);
    setInterval(fetchDevices, 30000);
}

async function fetchStatus() {
    try {
        const r = await fetch(B+'/api/status'); const d = await r.json();
        if (d.error) {
            el('connDot').className='conn-dot offline';
            el('connText').className='conn-text offline';
            el('connText').textContent='OFFLINE';
            return;
        }
        el('connDot').className='conn-dot online';
        el('connText').className='conn-text online';
        el('connText').textContent='ONLINE';
        const p = d.player;
        el('pName').textContent = p.name;
        el('pTitle').textContent = 'üèÖ '+p.title;
        el('pLevel').textContent = 'LV. '+p.level;
        const pct = Math.round(p.exp_progress*100);
        el('expL').textContent = 'EXP: '+p.exp+' / '+p.exp_to_next;
        el('expP').textContent = pct+'%';
        el('expF').style.width = pct+'%';
        const s = p.stats;
        el('sF').textContent=s.focus; el('sFbar').style.width=s.focus+'%';
        el('sP').textContent=s.productivity; el('sPbar').style.width=s.productivity+'%';
        el('sC').textContent=s.consistency; el('sCbar').style.width=s.consistency+'%';
        el('sR').textContent=s.creativity; el('sRbar').style.width=s.creativity+'%';
        el('sW').textContent=s.wellness; el('sWbar').style.width=s.wellness+'%';
        // Buffs
        const bc = el('buffList');
        if (p.active_buffs && p.active_buffs.length > 0) {
            bc.innerHTML = p.active_buffs.map(function(b) {
                return '<span class="buff-tag '+(b.is_debuff?'buff-neg':'buff-pos')+'">'+b.name+'</span>';
            }).join('');
        } else {
            bc.innerHTML = '<div class="empty">NO ACTIVE EFFECTS</div>';
        }
    } catch(e) {
        el('connDot').className='conn-dot offline';
        el('connText').className='conn-text offline';
        el('connText').textContent='OFFLINE';
    }
}

async function fetchQuests() {
    try {
        const r = await fetch(B+'/api/quests'); const d = await r.json();
        const c = el('questList');
        if (d.quests && d.quests.length > 0) {
            c.innerHTML = d.quests.map(function(q) {
                return '<div class="quest-item">' +
                    '<div class="quest-left"><span class="diff-badge d-'+q.difficulty+'">'+q.difficulty+'</span><span class="quest-title-text">'+q.title+'</span></div>' +
                    '<div class="quest-right"><span class="quest-exp">+'+q.exp_reward+' EXP</span>' +
                    '<button class="btn-sys" onclick="doneQ(\''+q.id+'\')">COMPLETE</button></div></div>';
            }).join('');
        } else {
            c.innerHTML = '<div class="empty">NO ACTIVE QUESTS</div>';
        }
    } catch(e) {}
}

async function fetchSnapshots() {
    try {
        const r = await fetch(B+'/api/snapshots?limit=8'); const d = await r.json();
        const c = el('timeline');
        if (d.snapshots && d.snapshots.length > 0) {
            c.innerHTML = d.snapshots.map(function(s) {
                var f = s.focus_score||0;
                var filled = Math.round(f*5);
                var bar = '';
                for(var i=0;i<5;i++) bar += i<filled?'‚óè':'‚óã';
                var t = new Date(s.timestamp).toLocaleTimeString('zh-CN',{hour:'2-digit',minute:'2-digit'});
                var html = '<div class="log-item"><span class="log-time">'+t+'</span><span class="log-focus">['+bar+']</span>';
                html += '<div class="log-text">'+(s.ai_analysis||s.activity_category||'...')+'</div>';
                if(s.inferred_motive) html += '<div class="log-motive">üí≠ '+s.inferred_motive+'</div>';
                html += '</div>';
                return html;
            }).join('');
        } else {
            c.innerHTML = '<div class="empty">NO ACTIVITY RECORDED</div>';
        }
    } catch(e) {}
}

async function fetchAchievements() {
    try {
        const r = await fetch(B+'/api/achievements'); const d = await r.json();
        var prog = d.progress||{};
        el('achPct').textContent = Math.round((prog.progress||0)*100)+'%';
        el('achLabel').textContent = (prog.unlocked||0)+' / '+(prog.total||0)+' UNLOCKED';
        const c = el('achList');
        if (d.achievements && d.achievements.length > 0) {
            c.innerHTML = d.achievements.map(function(a) {
                return '<div class="ach-item '+(a.unlocked?'ach-unlocked':'ach-locked')+'">' +
                    '<span class="ach-icon">'+(a.unlocked?'üèÜ':'üîí')+'</span>' +
                    '<div class="ach-info"><div class="ach-name">'+a.name+'</div><div class="ach-desc">'+a.description+'</div></div>' +
                    '<span class="ach-reward">+'+a.exp_reward+'</span></div>';
            }).join('');
        }
    } catch(e) {}
}

async function fetchPattern() {
    try {
        const r = await fetch(B+'/api/pattern'); const d = await r.json();
        var map = {
            deep_focus:{icon:'üî•',name:'DEEP FOCUS',desc:'ÂøÉÊµÅÁä∂ÊÄÅÔºåÊïàÁéáÊãâÊª°',color:'var(--cyan)'},
            distraction:{icon:'üí´',name:'DISTRACTED',desc:'È¢ëÁπÅÂàáÊç¢Ôºå‰∏ìÊ≥®Â∫¶‰Ωé',color:'var(--red)'},
            learning:{icon:'üìö',name:'LEARNING',desc:'Áü•ËØÜÂê∏Êî∂‰∏≠',color:'var(--green)'},
            creative:{icon:'üé®',name:'CREATIVE',desc:'ÂàõÈÄ†ÂäõÊøÄÂèë',color:'var(--cyan)'},
            fatigue:{icon:'üò¥',name:'FATIGUE',desc:'Âª∫ËÆÆ‰ºëÊÅØ‰∏Ä‰∏ã',color:'var(--red)'},
            procrastination:{icon:'‚õìÔ∏è',name:'PROCRASTINATING',desc:'Á≥ªÁªüÊ£ÄÊµãÂà∞ÊãñÂª∂Ë°å‰∏∫',color:'var(--red)'},
            normal:{icon:'‚è≥',name:'MONITORING',desc:'Á≥ªÁªüÊåÅÁª≠ÁõëÊµã‰∏≠',color:'var(--text-dim)'}
        };
        var p = map[d.pattern]||map.normal;
        // Update pattern display - inject into buff section area or use a notification
        // Pattern info is shown via the status connection
    } catch(e) {}
}

async function doneQ(id) {
    try {
        await fetch(B+'/api/quests/'+id+'/complete',{method:'POST'});
        fetchQuests(); fetchStatus();
    } catch(e) {}
}

async function fetchShop() {
    try {
        const r = await fetch(B+'/api/shop'); const d = await r.json();
        el('goldDisplay').textContent = 'üí∞ '+d.gold+'G';
        const c = el('shopList');
        if (d.items && d.items.length > 0) {
            c.innerHTML = d.items.filter(function(i){return i.available}).map(function(i) {
                return '<div class="shop-item">' +
                    '<div><div class="shop-name">'+i.name+'</div><div class="shop-desc">'+i.description+'</div></div>' +
                    '<div class="shop-right"><span class="shop-price">'+i.price+'G</span>' +
                    '<button class="btn-buy" onclick="buyItem(\''+i.id+'\')"'+(i.affordable?'':' disabled')+'>BUY</button></div></div>';
            }).join('');
        } else {
            c.innerHTML = '<div class="empty">NO ITEMS AVAILABLE</div>';
        }
    } catch(e) {}
}

async function fetchSkills() {
    try {
        const r = await fetch(B+'/api/skills'); const d = await r.json();
        var pc = el('passiveSkills');
        if (d.passive && d.passive.length > 0) {
            pc.innerHTML = d.passive.map(function(s) {
                return '<div class="skill-item '+(s.unlocked?'unlocked':'locked')+'">' +
                    '<span class="skill-icon">'+(s.unlocked?s.name.split(' ')[0]:'üîí')+'</span>' +
                    '<div class="skill-info"><div class="skill-name">'+s.name+'</div>' +
                    '<div class="skill-desc-text">'+(s.description||'')+'</div></div></div>';
            }).join('');
        } else {
            pc.innerHTML = '<div class="empty">NONE</div>';
        }
        var ac = el('activeSkills');
        if (d.active && d.active.length > 0) {
            ac.innerHTML = d.active.map(function(s) {
                var canUse = s.unlocked && !s.on_cooldown;
                return '<div class="skill-item '+(s.unlocked?'unlocked':'locked')+(canUse?' clickable':'')+'"'+(canUse?' onclick="useSkill(\''+s.id+'\')"':'')+'>' +
                    '<span class="skill-icon">'+(s.unlocked?s.name.split(' ')[0]:'üîí')+'</span>' +
                    '<div class="skill-info"><div class="skill-name">'+s.name+(s.on_cooldown?' <span class="skill-cd">CD:'+s.cooldown_remaining+'m</span>':'')+'</div>' +
                    '<div class="skill-desc-text">'+(s.description||'')+'</div></div></div>';
            }).join('');
        } else {
            ac.innerHTML = '<div class="empty">NONE</div>';
        }
    } catch(e) {}
}

async function fetchPenalty() {
    try {
        const r = await fetch(B+'/api/penalty'); const d = await r.json();
        var c = el('penaltyStatus');
        if (d.in_penalty_zone) {
            c.innerHTML = '<span class="penalty-icon">üèúÔ∏è</span>' +
                '<div class="penalty-status" style="color:var(--red)">PENALTY ZONE</div>' +
                '<div class="penalty-desc">ËøûÁª≠ '+d.consecutive_fails+' Â§©Êú™ÂÆåÊàêÊØèÊó•‰ªªÂä°</div>';
        } else {
            c.innerHTML = '<span class="penalty-icon">‚úÖ</span>' +
                '<div class="penalty-status" style="color:var(--green)">SAFE</div>' +
                '<div class="penalty-desc">ÊØèÊó•‰ªªÂä°Áä∂ÊÄÅÊ≠£Â∏∏</div>';
        }
    } catch(e) {}
}

async function buyItem(id) {
    try {
        await fetch(B+'/api/shop/buy/'+id,{method:'POST'});
        fetchShop(); fetchStatus();
    } catch(e) {}
}

async function useSkill(id) {
    try {
        await fetch(B+'/api/skills/'+id+'/activate',{method:'POST'});
        fetchSkills();
    } catch(e) {}
}

var DEVICE_ICONS = {mac:'üçé',windows:'ü™ü',linux:'üêß',android:'ü§ñ',ios:'üì±',unknown:'üíª'};

async function fetchDevices() {
    try {
        const r = await fetch(B+'/api/devices'); const d = await r.json();
        var stats = d.stats;
        var badge = el('deviceBadge');
        if (d.openclaw_available) {
            badge.textContent = 'OPENCLAW | '+stats.online_devices+'/'+stats.total_devices+' ONLINE';
            badge.style.color = 'var(--green)';
        } else {
            badge.textContent = 'OPENCLAW DISCONNECTED';
            badge.style.color = 'var(--red)';
        }
        var panel = el('devicePanel');
        if (d.devices && d.devices.length > 0) {
            panel.innerHTML = '<div class="device-grid">' + d.devices.map(function(dev) {
                var icon = DEVICE_ICONS[dev.device_type] || 'üíª';
                var isActive = dev.is_active;
                var statusColor = dev.status==='online'?'var(--green)':dev.status==='idle'?'var(--gold)':'var(--red)';
                var statusText = dev.status==='online'?'ONLINE':dev.status==='idle'?'IDLE':'OFFLINE';
                var html = '<div class="device-card '+(isActive?'active':'')+' '+(dev.status==='offline'?'offline':'')+'">';
                if(isActive) html += '<div class="device-active-dot"></div>';
                html += '<div class="device-icon">'+icon+'</div>';
                html += '<div class="device-name">'+dev.name+'</div>';
                html += '<div class="device-status-text" style="color:'+statusColor+'">'+statusText+(isActive?' ¬∑ ACTIVE':'')+'</div>';
                if(dev.current_window) html += '<div class="device-detail">ü™ü '+dev.current_window+'</div>';
                if(dev.battery_level>=0) html += '<div class="device-detail">üîã '+Math.round(dev.battery_level)+'%</div>';
                html += '</div>';
                return html;
            }).join('') + '</div>';
        } else {
            panel.innerHTML = '<div class="empty">'+(d.openclaw_available?'ÊöÇÊó†ÈÖçÂØπËÆæÂ§á„ÄÇÂú®‰Ω†ÁöÑ Mac/ÊâãÊú∫‰∏äÂÆâË£Ö OpenClaw Node Âç≥ÂèØËá™Âä®ÂèëÁé∞„ÄÇ':'OpenClaw Nodes Êú™Ê£ÄÊµãÂà∞„ÄÇÂ§öËÆæÂ§áÊÑüÁü•ÈúÄË¶Å OpenClaw ÊîØÊåÅ„ÄÇ')+'</div>';
        }
        // Device switch log
        try {
            var sr = await fetch(B+'/api/devices/switches'); var sd = await sr.json();
            if (sd.switches && sd.switches.length > 0) {
                el('deviceSwitches').style.display = 'block';
                el('switchList').innerHTML = sd.switches.slice(-5).reverse().map(function(s) {
                    var t = new Date(s.timestamp).toLocaleTimeString('zh-CN',{hour:'2-digit',minute:'2-digit'});
                    return '<div class="switch-item">'+t+' ‚Äî '+(s.from_name||'Êó†')+' ‚Üí '+s.to_name+'</div>';
                }).join('');
            }
        } catch(e2) {}
    } catch(e) {}
}

function connectWS() {
    var p = location.protocol==='https:'?'wss:':'ws:';
    ws = new WebSocket(p+'//'+location.host+B+'/ws');
    ws.onmessage = function(e) {
        try {
            var m = JSON.parse(e.data);
            if(m.notification) showNotif(m.notification);
            fetchStatus(); fetchQuests(); fetchAchievements();
        } catch(ex) {}
    };
    ws.onclose = function() { setTimeout(connectWS, 3000); };
    ws.onerror = function() { ws.close(); };
}

function showNotif(n) {
    var c = el('notifs');
    var d = document.createElement('div');
    d.className = 'notif';
    d.innerHTML = '<div class="notif-t">'+n.title+'</div><div class="notif-m">'+n.message+'</div>';
    c.appendChild(d);
    setTimeout(function(){ d.remove(); }, 5000);
}

init();
</script>
</body>
</html>
